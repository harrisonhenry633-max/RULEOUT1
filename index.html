<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>RULEOUT</title>
<style>
:root {
  --bg:#050b1a;
  --panel:#0b1630;
  --card:#0f1f45;
  --text:#e8f0ff;
  --muted:#8fa6ff;
  --accent:#3b82f6;
  --accent-soft:#60a5fa;
  --danger:#fb7185;
  --success:#34d399;
}
* { box-sizing:border-box; }
body {
  margin:0;
  min-height:100vh;
  font-family:system-ui,-apple-system,Segoe UI,sans-serif;
  background:radial-gradient(1000px 600px at top,#0f2a66,var(--bg));
  color:var(--text);
  overflow-x:hidden;
}
.start {
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:26px;
  background:radial-gradient(900px 500px at center,#123a8c,#050b1a);
  z-index:10;
}
.start h1 { font-size:68px; letter-spacing:.35em; }
.start p { max-width:560px; text-align:center; color:var(--muted); font-size:18px; }
.start button {
  padding:18px 66px;
  font-size:22px;
  border:none;
  border-radius:999px;
  cursor:pointer;
  font-weight:800;
}
#startPlayBtn { background:linear-gradient(135deg,var(--accent),var(--accent-soft)); color:white; }
.google-signin {
  padding:18px 66px;
  background:linear-gradient(135deg,var(--accent),var(--accent-soft));
  color:white;
  border:none;
  border-radius:999px;
  font-size:18px;
  font-weight:800;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:10px;
  box-shadow:0 8px 24px rgba(0,0,0,.4);
  transition:all .2s;
}
.google-signin:hover { box-shadow:0 12px 32px rgba(0,0,0,.5); transform:translateY(-2px); }
.google-icon { width:20px; height:20px; filter:brightness(0) invert(1); }
.signout-btn {
  position:fixed;
  top:16px;
  left:16px;
  padding:6px 10px;
  background:rgba(255,255,255,.08);
  color:var(--muted);
  border:1px solid rgba(255,255,255,.15);
  border-radius:6px;
  font-size:11px;
  font-weight:600;
  cursor:pointer;
  backdrop-filter:blur(10px);
  transition:all .2s;
  z-index:1000;
}
.signout-btn:hover { background:rgba(255,255,255,.15); border-color:rgba(255,255,255,.25); color:var(--text); }
.help-btn {
  position:fixed;
  bottom:16px;
  left:16px;
  width:40px;
  height:40px;
  background:rgba(59,130,246,.2);
  color:var(--accent-soft);
  border:2px solid var(--accent);
  border-radius:50%;
  font-size:20px;
  font-weight:800;
  cursor:pointer;
  backdrop-filter:blur(10px);
  transition:all .2s;
  z-index:1000;
  display:flex;
  align-items:center;
  justify-content:center;
}
.help-btn:hover { background:rgba(59,130,246,.3); transform:scale(1.1); }
.help-btn:disabled { opacity:.3; cursor:not-allowed; transform:scale(1); }
.game { display:none; padding:42px; min-height:100vh; }
.container { max-width:1100px; margin:0 auto; }
.progress-section {
  margin-bottom:32px;
  background:linear-gradient(180deg,var(--card),var(--panel));
  padding:24px 34px;
  border-radius:24px;
  box-shadow:0 16px 32px rgba(0,0,0,.3);
}
.category-title { font-size:24px; font-weight:900; color:var(--accent-soft); margin-bottom:12px; text-transform:uppercase; letter-spacing:.1em; }
.stats-row { display:flex; gap:32px; align-items:center; flex-wrap:wrap; }
.stat { display:flex; flex-direction:column; gap:4px; }
.stat-label { font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.05em; }
.stat-value { font-size:32px; font-weight:900; color:var(--success); }
.progress-bar { width:100%; height:12px; background:rgba(0,0,0,.3); border-radius:999px; overflow:hidden; margin-top:16px; }
.progress-fill { height:100%; background:linear-gradient(90deg,var(--accent),var(--accent-soft)); transition:width .3s ease; border-radius:999px; }
.puzzle-grid { display:grid; grid-template-columns:1.3fr .7fr; gap:44px; margin-bottom:32px; }
.card { background:linear-gradient(180deg,var(--card),var(--panel)); padding:34px; border-radius:24px; box-shadow:0 32px 64px rgba(0,0,0,.45); }
.clue { font-size:19px; margin-bottom:16px; line-height:1.6; }
.constraints { color:var(--danger); line-height:1.8; font-size:15px; margin-bottom:26px; }
.counter { font-size:34px; font-weight:900; color:var(--accent-soft); }
input { width:100%; padding:18px; font-size:20px; border-radius:16px; border:none; outline:none; background:#020617; color:var(--text); text-align:center; }
button { width:100%; padding:18px; margin-top:16px; border-radius:16px; border:none; font-weight:900; cursor:pointer; }
.submit { background:var(--accent); color:white; }
.message { margin-top:20px; min-height:32px; text-align:center; font-size:16px; }
.success-overlay {
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:20px;
  background:rgba(16,185,129,.15);
  backdrop-filter:blur(8px);
  z-index:999;
  animation:fadeIn .3s ease;
}
.success-text {
  font-size:84px;
  font-weight:900;
  letter-spacing:.25em;
  color:var(--success);
  text-shadow:0 0 30px rgba(16,185,129,.5);
  animation:pop 2.5s ease forwards;
}
.points-earned {
  font-size:48px;
  font-weight:800;
  color:var(--accent-soft);
  animation:slideUp .5s ease .3s both;
}
.confetti {
  position:absolute;
  width:10px;
  height:10px;
  background:var(--success);
  animation:confettiFall 2s ease-out forwards;
}
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
@keyframes pop { 0%{opacity:0;transform:scale(.6)} 15%{opacity:1;transform:scale(1.1)} 85%{opacity:1;transform:scale(1)} 100%{opacity:0;transform:scale(1.05)} }
@keyframes slideUp { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:translateY(0)} }
@keyframes confettiFall { to{transform:translateY(100vh) rotate(360deg); opacity:0;} }
@media(max-width:768px){ .puzzle-grid{grid-template-columns:1fr} .stats-row{justify-content:space-between} }
</style>
</head>
<body>

<div class="start" id="start">
 <h1>RULEOUT</h1>
 <p>Decode the clues. Follow the rules. Guess the word. 5 attempts to crack each puzzle. New challenges daily.</p>
 <button id="startPlayBtn" onclick="startGame()">â–¶ PLAY</button>
 <button class="google-signin" id="authBtn" onclick="handleAuth()">
  <svg class="google-icon" viewBox="0 0 24 24">
   <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
   <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
   <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
   <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
  </svg>
  <span id="authText">Sign in with Google</span>
 </button>
</div>

<div class="game" id="game" style="display:none">
 <button class="signout-btn" id="signoutBtn" style="display:none" onclick="signOutUser()">Sign Out</button>
 <button class="help-btn" id="helpBtn" onclick="getHint()" title="Get an extra clue">?</button>
 <div class="container">
  <div class="progress-section">
   <div class="category-title" id="categoryTitle">STATS</div>
   <div class="stats-row">
    <div class="stat"><div class="stat-label">Total Points</div><div class="stat-value" id="totalPoints">0</div></div>
    <div class="stat"><div class="stat-label">Streak</div><div class="stat-value" id="streakDisplay">0</div></div>
    <div class="stat"><div class="stat-label">Puzzle</div><div class="stat-value" id="puzzleNum">1/5</div></div>
   </div>
   <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
  </div>
  <div class="puzzle-grid">
   <div class="card">
    <div style="font-size:14px;color:var(--accent-soft);font-weight:700;margin-bottom:12px;text-transform:uppercase" id="currentCategoryDisplay">SPORTS</div>
    <div class="clue" id="clue"></div>
    <div class="constraints" id="constraints"></div>
    <div class="counter" id="counter"></div>
   </div>
   <div class="card">
    <input id="guess" placeholder="Type the word that fits"/>
    <button class="submit" onclick="submitGuess()">Submit</button>
    <div class="message" id="message"></div>
   </div>
  </div>
 </div>
</div>

<div class="start" id="victory" style="display:none">
 <h1 style="font-size:72px;color:var(--success);text-shadow:0 0 40px rgba(52,211,153,.6)">ðŸŽ‰</h1>
 <h2 style="font-size:48px;margin:0">YOU BEAT RULEOUT!</h2>
 <p style="font-size:24px;color:var(--accent-soft);margin:20px 0">Final Score: <span id="finalScore" style="font-weight:900">0</span> points</p>
 <button style="background:linear-gradient(135deg,var(--success),#10b981);color:white" onclick="playAgain()">â–¶ PLAY AGAIN</button>
</div>

<script type="module">
document.addEventListener('DOMContentLoaded', () => {

  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDpncc72bVroaBydIlfk4f4Il0ag0dPPP0",
    authDomain: "ruleout-14bdb.firebaseapp.com",
    projectId: "ruleout-14bdb",
    storageBucket: "ruleout-14bdb.firebasestorage.app",
    messagingSenderId: "497779197134",
    appId: "1:497779197134:web:3194021bd696fa1b437c9f",
    measurementId: "G-7BBMSV6GZJ"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  let currentUser = null;
  let authReady = false;

  onAuthStateChanged(auth, (user) => {
    currentUser = user;
    authReady = true;
    updateAuthButton();
  });

  function updateAuthButton() {
    const authBtn = document.getElementById('authBtn');
    const playBtn = document.getElementById('startPlayBtn');
    const signoutBtn = document.getElementById('signoutBtn');

    if (currentUser) {
      authBtn.style.display = 'none';
      playBtn.style.display = 'inline-block';
      signoutBtn.style.display = 'block';
    } else {
      authBtn.style.display = 'flex';
      playBtn.style.display = 'inline-block';   // always show PLAY, even without login
      signoutBtn.style.display = 'none';
    }
  }

  window.signOutUser = () => {
    signOut(auth).then(() => {
      localStorage.removeItem('ruleout_progress');
      window.location.reload();
    }).catch(err => console.error("Sign out error:", err));
  };

  window.handleAuth = () => {
    if (currentUser) {
      signOutUser();
    } else {
      signInWithPopup(auth, provider)
        .then(result => console.log('Signed in:', result.user.displayName))
        .catch(error => {
          console.error('Sign-in error:', error);
          alert('Sign-in failed: ' + (error.message || 'Unknown error'));
        });
    }
  };

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // GAME LOGIC
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const maxGuesses = 5;
  let puzzles = [];
  let categoryIndex = 0;
  let puzzleIndex = 0;
  let guessesLeft = maxGuesses;
  let constraints = [];
  let currentCategory = "";
  let totalPoints = 0;
  let streak = 0;
  let hintUsed = false;

  const WORD_CATEGORIES = [ /* your full categories here â€“ paste them if needed */ 
    // Example â€“ replace with your complete list
    {
      name: "SPORTS",
      words: [
        {clues: ["Racket sport", "Fast indoor game", "Shuttlecock"], a: "badminton"},
        {clues: ["Water rescue", "Board and waves", "Hang ten"], a: "surfing"},
        // ... add all 10
      ]
    },
    // ... other categories ...
  ];

  function seed() {
    const d = new Date();
    return d.getFullYear() * 1000 + d.getMonth() * 50 + d.getDate();
  }

  function rng(s) {
    return () => (s = (s * 9301 + 49297) % 233280) / 233280;
  }

  function startGame() {
    document.getElementById("start").style.display = "none";
    document.getElementById("game").style.display = "block";
    loadProgress().then(loaded => {
      if (!loaded) {
        categoryIndex = 0;
        puzzleIndex = 0;
        guessesLeft = maxGuesses;
        totalPoints = 0;
        streak = 0;
        hintUsed = false;
      }
      setup();
      load();
      updateStats();
    }).catch(console.error);
  }

  // ... rest of your game functions (setup, genConstraints, violates, update, getHint, updateStats, submitGuess, win, fail, nextPuzzle, showVictoryScreen, load, saveProgress, loadProgress, playAgain) ...
  // Copy-paste them from your previous working version

  // Initial call
  updateAuthButton();

});
</script>
</body>
</html>
